name: Ejecutar Colab/Notebook

on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  run_notebook:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # Instalar paquetes necesarios y registrar kernel
      - name: Instalar paquetes necesarios
        run: |
          python -m pip install --upgrade pip
          pip install jupyter nbconvert papermill ipykernel matplotlib requests
          python -m ipykernel install --user --name=python3 --display-name "Python 3"

      # Verificar existencia del notebook
      - name: Verificar notebook
        run: |
          NOTEBOOK="Horarios de labos del 0.ipynb"
          if [ ! -f "$NOTEBOOK" ]; then
            echo "Error: No se encontr√≥ el notebook '$NOTEBOOK'."
            exit 1
          fi

      # Ejecutar notebook
      - name: Ejecutar notebook
        run: |
          papermill "Horarios de labos del 0.ipynb" "Horarios_de_labos_del_0_out.ipynb"

      # Commit y push resultados si hay cambios
      - name: Commit y push resultados
        run: |
          git add Horarios_de_labos_del_0_out.ipynb
          if ! git diff --cached --quiet; then
            git commit -m "Actualizar notebook ejecutado"
            git pull --rebase origin main
            git push origin main
          else
            echo "No hay cambios en el notebook de salida"
